name: üî® Manual APK Build

on:
  workflow_dispatch:  # –¢–û–õ–¨–ö–û —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  build-apk:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ó–∞–±–∏—Ä–∞–µ–º –∫–æ–¥
    - name: üì• –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥
      uses: actions/checkout@v4
    
    # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º JDK 17
    - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Java
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    # 3. –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞–≥ –∫–ª—é—á
    - name: üîë –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –ø–æ–¥–ø–∏—Å–∏
      run: |
        keytool -genkey -v \
          -keystore debug.keystore \
          -alias androiddebugkey \
          -keyalg RSA \
          -keysize 2048 \
          -validity 10000 \
          -storepass android \
          -keypass android \
          -dname "CN=Android Debug, O=Android, C=US"
    
    # 4. –î–∞–µ–º –ø—Ä–∞–≤–∞ —Å–∫—Ä–∏–ø—Ç—É
    - name: üîß –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Gradle
      run: |
        chmod +x gradlew
        echo "sdk.dir=$ANDROID_HOME" > local.properties
        echo "org.gradle.jvmargs=-Xmx4g" > gradle.properties
    
    # 5. –°–æ–±–∏—Ä–∞–µ–º APK
    - name: üî® –°–æ–±—Ä–∞—Ç—å APK
      run: |
        ./gradlew clean
        ./gradlew assembleDebug --stacktrace
        echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    
    # 6. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ APK
    - name: üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ APK
      run: |
        echo "=== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û APK ==="
        echo "–†–∞–∑–º–µ—Ä: $(du -h app/build/outputs/apk/debug/app-debug.apk | cut -f1)"
        echo ""
        echo "–î–µ—Ç–∞–ª–∏:"
        aapt dump badging app/build/outputs/apk/debug/app-debug.apk | grep -E "package:|version|launchable-activity:"
    
    # 7. –ó–∞–≥—Ä—É–∂–∞–µ–º APK
    - name: üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å APK
      uses: actions/upload-artifact@v4
      with:
        name: DanilkaAI-APK
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 90
    
    # 8. –°–æ–∑–¥–∞–µ–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
    - name: üîó –°–æ–∑–¥–∞—Ç—å –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
      run: |
        echo "üìé –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ APK:"
        echo "https://nightly.link/${{ github.repository }}/workflows/manual_build/${{ github.run_id }}/DanilkaAI-APK.zip"
